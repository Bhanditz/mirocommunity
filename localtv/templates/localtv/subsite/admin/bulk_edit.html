{% extends "localtv/subsite/admin/base.html" %}

{% block body_class %}bulkedit{% endblock body_class %}


{% load i18n versioned pagetabs %}

{% block title %}{{ block.super }} - {% trans "Admin - Bulk Edit" %}{% endblock %}
{% block head %}{{ block.super }}
  <script type="text/javascript" src="{% versioned "/js/bulk_edit.js" %}"></script>
{% endblock %}
{% block content %}
<div id="labels">

  <div class="floatleft form_wrap rounded">
    <select id="bulk_action_selector" class="behave">
      <option value="edit">Edit</option>
      <option value="delete">Delete</option>
      <option value="unapprove">Unapprove</option>
      <option value="feature">Feature</option>
      <option value="unfeature">Unfeature</option>
    </select>
    <button type="button" class="med_button" onclick="bulkAction();"><span>Apply</span></button>
  </div>

  <form action="" method="GET">

    <div class="floatleft form_wrap rounded">
    <select class="behave" name="category">
      <option value="">Show All Categories</option>
      {% for category in categories %}
      <option {% ifequal category.pk|stringformat:"i" request.GET.category %}selected=selected {% endifequal %}value="{{ category.pk }}">{{ category.name }}</option>
      {% endfor %}
    </select>
    <button class="med_button"><span>Filter</span></button>
  </div>
  </form>

  
  <form method="POST" action="{{ request.get_full_path }}">
    {% pagetabs page %}
  <table id="massedit" class="rounded">

    <tbody>
      <tr class="editing last">
        <td colspan="3">
          <h3>Bulk Edit (this will edit all selected videos) <a href="{{ request.get_full_path }}">(cancel)</a></h3>
          {% with formset.forms|last as form %}
          <table>
            <tr>
              <td colspan="2">
                <label>Title</label>
                {{ form.name }}
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <label>Date</label>
                {{ form.when_published }}
            </td>
            </tr>
            <tr>
              <td>
                <label class="floatnone">Description</label>
                {{ form.description }}
              </td>
              <td>
                <label class="floatnone">Tags</label>
                {{ form.tags }}
              </td>
            </tr>


          </table>

          <button class="med_button marginbottom behave"><span>Update Video</span></button>


        </td>
        <td width="250" class="checklist">
          <label class="padding">Categories</label>
          {{ form.categories }}
        </td>
        <td width="250" class="checklist">
          <label class="padding">Authors</label>
          {{ form.authors }}
        </td>
      {% endwith %}
      </tr>
    </tbody>
  </table>


  <br />
  <br />
  <br />


    <table class="rounded">
    <thead>
      <tr>
        <th class="checkbox"><input type="checkbox" id="toggle_all"/></th>
        <script type="text/javascript">
            $("#toggle_all").click(function() {
                if (this.checked) {
                    $('td:first-child input[type=checkbox]:not(:checked)').click()
                } else {
                    $('td:first-child input[type=checkbox]:checked').click();
                }
            });
        </script>
        {% for header in headers %}
        <th>
            {% if header.sort %}
            <a class="{% if forloop.last %}last {% endif %}{{ header.class }}" href="{{ header.link }}">
              {{ header.label }}
            </a>
            {% else %}
            <span>{{ header.label }}
            {% endif %}
        {% endfor %}
      </tr>
      {{ formset.management_form }}
      <input type="hidden" id="bulk_action" name="bulk_action" value="">
    </thead>
    <tbody>
      {% if formset.non_form_errors %}
      <tr>
        <td colspan="4">{{ formset.non_form_errors }}</td>
      </tr>
      {% endif %}
      {% for form in formset.forms|slice:":-1" %}
      <tr class="{% cycle "" "grey" %}" {% if form.errors %}style="display: none;"{% endif %}>
        <td>{{ form.bulk }}</td>
        <td>
          <a href="{{ form.instance.get_absolute_url }}">{{ form.instance.name }}</a>
          <div class="actions">
            <a href="#" onclick="return showEdit(this, true);">Edit</a> | <a href="#" class="delete_icon" onclick="return toggleDelete(this);">Delete</a> {{ form.DELETE.as_hidden }} | <a href="{{ form.instance.get_absolute_url }}" class="view_icon">View</a>
          </div>
        </td>
        <td>
          {% if form.instance.video_service %}
          {{ form.instance.video_service }} User
          <strong>{% if form.instance.feed %}{{ form.instance.feed.name }}{% else %}{{ form.instance.video_service_user }}{% endif %}</strong>
          {% else %}
          {% if form.instance.search %}
          Saved Search: <strong>{{ form.instance.search.query_string }}</strong>
          {% endif %}
          {% endif %}
        </td>
        <td>{% for category in form.instance.categories.all %}{{ category.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
        <td class="last" width="19%">{% if form.instance.when_published %}<span class="pub_date">{{ form.instance.when_published|date:"M, d Y" }}</span>{% endif %} </td>
      </tr>
      <tr class="editing {% cycle "" "grey" %}" {% if not form.errors %}style="display: none;"{% endif %}>
        <td colspan="3">
          {{ form.non_field_errors }}
          {{ form.name.errors }}
          <h3>{{ form.name }} <a href="{{ request.get_full_path }}">(cancel)</a></h3>
          {{ form.id }}
          <table>
            <tr>
              <td colspan="2">
                <label>Video URL</label>
                {{ form.file_url.errors }}
                {{ form.file_url }}
              </td>
            </tr>
            <tr>
              <td colspan="2">
                <label>Thumb URL</label>
                {{ form.thumbnail_url.errors }}{{ form.thumbnail.errors }}
                {{  form.thumbnail_url }}
                <div style="float: right; width: 286px;">
                  or <a href="#" onclick="$(this).next().show(); return false;">upload</a> a new thumbnail
                  <span style="display: none;">{{ form.thumbnail }}</span>
                </div>
            <tr>
              <td colspan="2">
                <label>Date</label>
                {{ form.when_published.errors }}
                {{ form.when_published }}
            </td>
            </tr>
            <tr>
              <td>
                <label class="floatnone">Description</label>
                {{ form.description.errors }}
                {{ form.description }}
              </td>
              <td>
                <label class="floatnone">Tags</label>
                {{ form.tags.errors }}
                {{ form.tags }}
              </td>
            </tr>


          </table>

          <button class="med_button marginbottom behave"><span>Update Video</span></button>


        </td>

        <td width="250" class="checklist">
          <label class="padding">Categories</label>
          {{ form.categories.errors }}
          {{ form.categories }}
        </td>
        <td width="250" class="checklist">
          <label class="padding">Authors</label>
          {{ form.authors.errors }}
          {{ form.authors }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% pagetabs page %}
</form>
</div>
{% endblock content %}

