{% extends "localtv/subsite/admin/base.html" %}

{% block body_class %}bulkedit{% endblock body_class %}


{% load i18n %}

{% block title %}{{ block.super }} - {% trans "Admin - Bulk Edit" %}{% endblock %}

{% block content %}
  <div id="above_admin_table">
    {% include "localtv/subsite/admin/header.html" %}
  </div>

<div id="massedit">
  <h2>Batch Edit Mode</h2>
  <div>
    <span id="selected_count"></span> selected.  Fields you choose to edit will replace current field contents for these videos. Fields you do not edit will not be affected.
  </div>
  <div>
    <input type="checkbox" name="name" />
    <span>Title</span>
  </div>
  <div>
    <input type="checkbox" name="categories" />
    <span>Categories</span>
  </div>
  <div>
    <input type="checkbox" name="authors" />
    <span>Authors</span>
  </div>
  <div>
    <input type="checkbox" name="tags" />
    <span>Tags</span>
  </div>
  <div>
    <input type="checkbox" name="description" />
    <span>Description</span>
  </div>
  <button>Save multiple edits</button>
</div>
<form method="POST" action="">
  {{ formset.management_form }}
  <table>
    {% for form in formset.forms %}
    {% if forloop.first or forloop.counter|divisibleby:"10" %}
    <tr>
      <td><strong>Select All/None</strong><input type="checkbox" onclick="$('input[name$=bulk]').click().eq(0).change();"></td>
      {% for field in formset.forms.0 %}
      {% if not field.is_hidden %}
      {% ifnotequal field.name "bulk" %}
      <td><strong>{{ field.label }}</strong</td>
      {% endifnotequal %}
      {% endif %}
      {% endfor %}
      <td><strong>Source</strong></td>
      <td>
        <input type="submit" value="Save">
      </td>
    </tr>
    {% endif %}
    <tr>
      <td>
        {{ form.bulk }}
        {{ form.errors }}
      </td>
      <td>
        <div class="value">
          {{ form.instance.name }}
        </div>
        <div class="field">
          {{ form.name }}
        </div>
      </td>
      <td>
        <div class="value">
          click to edit
        </div>
        <div class="field">
          {{ form.description }}
        </div>
      </td>
      <td>
        <div class="value">
          {{ form.instance.file_url }}
        </div>
        <div class="field">
          {{ form.file_url }}
        </div>
      </td>
      <td>
        <div class="value">
          click to edit
        </div>
        <div class="field">
          {{ form.embed_code }}
        </div>
      </td>
      <td>
        <div class="value">
          {% for tag in form.instance.tags.all %}
          {{ tag.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </div>
        <div class="field">
          {{ form.tags }}
        </div>
      </td>
      <td>
        <div class="value">
          {% for category in form.instance.categories.all %}
          {{ category.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </div>
        <div class="field">
          {{ form.categories }}
        </div>
      </td>
      <td>
        <div class="value">
          {% for author in form.instance.authors.all %}
          {{ author.name }}{% if not forloop.last %}, {% endif %}
          {% endfor %}
        </div>
        <div class="field">
          {{ form.authors }}
        </div>
      </td>
      <td>
        <div class="value">
          click to edit
        </div>
        <div class="field">
          {{ form.thumbnail }}
        </div>
      </td>
      <td>{{ form.DELETE }}</td>
      <td>
        {% if form.instance.feed %}
        Feed: {{ form.instance.feed }}
        {% else %}
        {% if form.instance.search %}
        Search: {{ form.instance.search }}
        {% endif %}
        {% endif %}
      </td>
      <td><a href="{{ form.instance.get_absolute_url }}">link</a></td>
    </tr>
    {% endfor %}
  </table>
</form>
<script type="text/javascript">
$("td div").click(
    function() {
        $(this).hide().next().show();
    });
$("input[name$='bulk']").change(
    function() {
        selected_count = $("input[name$='bulk']:checked").length;
        if (selected_count) {
            if (selected_count > 1) {
                $("#selected_count").text(selected_count + ' videos');
            } else {
                $("#selected_count").text(selected_count + ' video');
            }
            $("#massedit").show();
        } else {
            $("#massedit").hide();
        }
    });
$("#massedit input[type=checkbox]").click(
    function() {
        if (this.checked) {
            checked = $("input[name$='bulk']:checked:eq(0)");
            selector = "[name$='" + this.name + "']:eq(0)";
            input = checked.parent().parent().find(
                "input"+selector + ', textarea'+selector + ', select'+selector);
            $(this).next().after(input.clone());
        } else {
            $(this).next().next().remove();
        }
        if ($("#massedit input[type=checkbox]:checked").length) {
            $("#massedit button").show();
        } else {
            $("#massedit button").hide();
        }
    });
$("#massedit button").click(
    function() {
        $("input[name$='bulk']:checked").each(function() {
            row = $(this).parent().parent();
            $("#massedit input[type=checkbox]:checked").each(function() {
                mass_input = $(this).next().next();
                selector = "[name$='" + this.name + "']:eq(0)";
                input = row.find(
                    "input"+selector + ', textarea'+selector + ', select'+selector);
                input.val(mass_input.val());
            });
        });
        $('form').submit();
    });
</script>
{% endblock content %}
