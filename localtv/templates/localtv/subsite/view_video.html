{% extends "localtv/subsite/base.html" %}

{% load embed_video i18n %}

{% block body_id %}view_video{% endblock %}


{% block title %}{{ block.super }} - {{ current_video.name }}{% endblock %}

{% block head %}
  {% if edit_video_form %}
    <script src="/js/edit_form.js"
            type="text/javascript">
    </script>
  {% endif %}
{% endblock %}

{% block content %}
  {% if edit_video_form %}
    {% include "localtv/subsite/admin/edit_video_form.html" %}
  {% endif %}

  <div id="main">
    {% if current_video.name %}
      <h2 class="vid_title{% if edit_video_form %} editable{% endif %}">
        {{ current_video.name }}
      </h2>
    {% else %}
      <h2 class="vid_title{% if edit_video_form %} editable{% endif %}">
        {% trans "(no title)" %}
      </h2>
    {% endif %}
    <span class="date">{{ current_video.when|timesince }} ago</span>
    <div id="video_wrapper">
      {% embed_video current_video %}
    </div>

    <div class="action">
      <a href="#" id="flag_button" class="med_button">
        <span>Flag Video<img src="/images/arrow_down.png" /></span>
      </a>

      <a href="#" id="share_button" class="med_button">
        <span>Share Video<img src="/images/arrow_down.png" /></span>
      </a>

      <a href="{{ current_video.website_url }}" id="seperate" class="med_button">
        <span>See video on its original page</span>
      </a>
    </div>

    <p class="description{% if edit_video_form %} editable{% endif %}">
      {% autoescape off %}
        {{ current_video.description|striptags }}
      {% endautoescape %}
      {% if edit_video_form and not current_video.description|striptags %}
      edit description
      {% endif %}
    </p>

    <div id="tags">
      {% if current_video.categories.count or edit_video_form %}
        <h3{% if edit_video_form %} class="categories editable"{% endif %}>Categories - </h3>

        <ul>
          {% for category in current_video.categories.all %}
            <li><a href="{{ category.get_absolute_url }}">{{ category.name }}</a></li> 
          {% endfor %}
        </ul>
      {% endif %}

      {% if current_video.tags.count %}
        <h3>Tags - </h3>

        <ul>
          {% for tag in current_video.tags.all %}
            <li>{{ tag.name }}</li> 
          {% endfor %}
        </ul>
      {% endif %}
      {% if current_video.authors.count or edit_video_form %}
      <h3{% if edit_video_form %} class="authors editable"{% endif %}>Authors - </h3>
        <ul>
          {% for author in current_video.authors.all %}
            <li><a href="{{ author.get_absolute_url }}">{{ author.name }}</a></li> 
          {% endfor %}
        </ul>

      {% endif %}
      {% if openid_localtv.admin_for_current_site %}
  <h3>{{ current_video|pprint }}</h3>
  {% if currrent_video.submitter %}<h3>Submitted by <ul><li>{{ current_video.submitter }}</h3>{% endif %}
  {% if current_video.search %}<h3>From search {{ current_video.search }}</h3>{% endif %}
  {% if current_video.feed %}<h3>From feed {{ current_video.feed }}</h3>{% endif %}
  <h3>Website URL {{ current_video.website_url|urlize }}</h3>
  {% endif %}
      <form id="add_tag">
        <input type="text" class="text_field" />
        <input type="image" id="suggest_tag" src="/images/suggest.png" value="submit" />

        <a href="#" class="log_push">Login to add a tag</a>
      </form>

      <br class="clear" />
    </div>

    <!-- Intensedebate would normally go here -->
    {% if intensedebate_acct %}
      {% include "localtv/subsite/intensedebate.html" %}
    {% endif %}
  </div>

  <div id="sidebar">

    <div id="about">
      {% autoescape off %}
        {{ sitelocation.sidebar_html }}
      {% endautoescape %}
    </div>

    <div id="sidebar_header">
      <h2>Most Popular</h2>

      <div class="floatright">
        {% url localtv_subsite_feeds_popular as popular_rss %}
        <a href="{{ popular_rss }}" class="rss">RSS</a> |
        <a href="http://subscribe.getmiro.com/?url1=http%3A//{{ sitelocation.site.domain|urlencode }}{{ popular_rss|urlencode }}" class="miro-subscribe">Subscribe</a>
      </div>
    </div>

    {% for video in popular_videos %}
      {% include "localtv/subsite/sidebar_video.html" %}
    {% endfor %}

  </div>
{% endblock content %}
