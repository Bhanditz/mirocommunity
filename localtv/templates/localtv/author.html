{% extends "localtv/__base.html" %}
{% load comments %}
{% load author_comment %}
{% comment %}
Copyright 2012 - Participatory Culture Foundation

This file is part of Miro Community.

Miro Community is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at your
option) any later version.

Miro Community is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with Miro Community.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}

{% load filters %}

{% block title %}{{ block.super }} - {% if author.first_name %}{{ author.get_full_name }} ({{ author.username }}){% else %}{{ author.username }}{% endif %}{% endblock %}

{% block body_classes %}{{ block.super }} author-page{% endblock %}

{% block content %}
	<header class="page-header">
		<h1 class="page-title">{% if author.first_name %}{{ author.get_full_name }} ({{ author.username }}){% else %}{{ author.username }}{% endif %}</h1>
		<div class="page-actions">
			<ul class="action-list">
				<li><a class="rss" href="{% url localtv_feeds_author author.pk %}">RSS</a></li>
			</ul>
		</div>
	</header>

	<div class="page-content">
		<div class="row">
			<aside class="author-info col-one-third content-box">
				{% if author.get_profile.logo %}
					<img src="{{ author.get_profile.logo.url }}">
				{% endif %}
				<ul class="author-detail-list">
					{% if author.get_profile.location %}<li class="author-location">{{ author.get_profile.location }}</li>{% endif %}
					{% if author.get_profile.website %}<li class="author-website"><a href="{{ author.get_profile.website }}">Website</a></li>{% endif %}
				</ul>
				<div>{{ author.get_profile.description|sanitize }}</div>
				
				{% get_author_comment_count for author as comment_count %}
				
				{% if comment_count %}
					<div id="author_comments"><h2 class="comments-title">{{ comment_count }} Recent Comment{{ comment_count|pluralize }}</h2>{% endif %}
					{% get_author_comments for author as comments %}
						{% if comments %}
						<ul id="author-comments">
							{% for comment in comments %}
								<li class="comment">
									<div class="comment-poster">
										<h4 id="c{{ comment.id }}">{% if comment.content_object %}<a href="{% url localtv_view_video comment.content_object.pk comment.content_object.slug %}">{{ comment.content_object.name }}</a>{% else %}{{ comment.user_name }}{% endif %}</h4>
										<span>{{ comment.submit_date|date:"F j, Y," }}<br/> {{ comment.submit_date|date:"g:i a T" }}</span>
										{% if user_is_admin %}
											<div class="comment-moderation">
												<form action="{% url comments-delete comment.id %}" method="post">{% csrf_token %}
													<input type="hidden" name="next" value="{{ request.META.PATH_INFO }}">
													<button type="submit">delete</button>
												</form>
												<form action="{% url comments-spam comment.id %}" method="post">{% csrf_token %}
													<input type="hidden" name="next" value="{{ request.META.PATH_INFO }}">
													<button type="submit">spam</button>
												</form>
											</div>
										{% endif %}
									</div>
									<div class="comment-body">
										{{ comment.comment|sanitize }}
									</div>
								</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}
				
			</aside>
			<div class="author-videos col-two-thirds content-box right">
				{% include "localtv/_video_summary_list.html" %}
			</div>
		</div>
	</div>
{% endblock %}
