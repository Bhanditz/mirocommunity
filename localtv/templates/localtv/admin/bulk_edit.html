{% extends "localtv/admin/base.html" %}
{% comment %}
Copyright 2009 - Participatory Culture Foundation

This file is part of Miro Community.

Miro Community is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at your
option) any later version.

Miro Community is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with Miro Community.  If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}


{% block body_class %}bulkedit{% endblock body_class %}


{% load i18n uploadtemplate_tags pagetabs %}

{% block title %}{{ block.super }} - {% block subtitle %}{% trans "Admin - Bulk Edit" %}{% endblock %}{% endblock %}
{% block head %}{{ block.super }}
  <script type="text/javascript" src="{% get_static_url "/js/bulk_edit.js" %}"></script>
{% endblock %}
{% block content %}
  {% block pre-labels %}
  {% endblock %}
<div id="labels">
  {% block pre-form %}
  <div class="floatleft form_wrap rounded">
    <select id="bulk_action_selector" class="behave">
      <option value="edit">Edit</option>
      <option value="delete">Delete</option>
      <option value="unapprove">Unapprove</option>
      <option value="feature">Feature</option>
      <option value="unfeature">Unfeature</option>
    </select>
    <button type="button" class="med_button" onclick="bulkAction();"><span>Apply</span></button>
  </div>

  <form action="" method="get">

    <div class="floatleft form_wrap rounded">
    <select class="behave" name="category">
      <option {% if not request.GET.category %}selected="selected"{% endif %}  value="">Show All Categories</option>
      {% for category in categories %}
      <option {% ifequal category.pk|stringformat:"i" request.GET.category %}selected=selected {% endifequal %}value="{{ category.pk }}">{{ category.name }}</option>
      {% endfor %}
    </select>
    <select class="behave" name="author">
      <option {% if not request.GET.user %}selected="selected"{% endif %} value="">Show All Users</option>
      {% for user in users %}
      <option {% ifequal user.pk|stringformat:"s" request.GET.author %}selected="selected"{% endifequal %} value="{{ user.pk }}">{% if user.first_name %}{{ user.get_full_name }}{% else %}{{ user.username }}{% endif %}</option>
      {% endfor %}
    </select>
    <label for="id_featured">Show only featured</label>
    <input type="checkbox" id="id_featured" name="featured" {% if request.GET.featured %}checked="checked"{% endif %}/>
    <input type="text" class="small_field" name="q" value="{{ search_string }}" />
    <button class="med_button floatright"><span>Search</span></button>
  </div>
  </form>
  {% endblock %}
  <form method="post" action="{{ request.get_full_path }}" enctype="multipart/form-data">
    {% block massedit %}
    {% ifnotequal formset.initial_form_count formset.total_form_count %}
  <table id="massedit" class="rounded">

    <tbody>
      <tr class="editing last">
        <td colspan="3">
          <h3>Bulk Edit (this will edit all selected videos) <a href="{{ request.get_full_path }}">(cancel)</a></h3>
          {% with formset.forms|last as form %}
          <table>
            <tr>
              <td colspan="2">
                <label>Title</label>
                {{ form.name }}
              </td>
            </tr>
            <tr>
                <td colspan="2">
                  <label>Thumb URL</label>
                  {{ form.thumbnail_url }}
                  <div style="float: right; width: 286px;">
                    or <a href="#" onclick="$(this).next().show(); return false;">upload</a> a new thumbnail
                    <span style="display: none;">{{ form.thumbnail }}</span>
                  </div>
                </td>
            </tr>
            <tr>
              <td colspan="2">
                <label>Date</label>
                {{ form.when_published }}
              </td>
            </tr>
            <tr>
              <td>
                <label class="floatnone">Description</label>
                {{ form.description }}
              </td>
              <td>
                <label class="floatnone">Tags</label>
                {{ form.tags }}
              </td>
            </tr>


          </table>

          <button class="med_button marginbottom behave"><span>Update Video</span></button>


        </td>
        <td width="250" class="checklist">
          <label class="padding">Categories</label>
          {{ form.categories }}
        </td>
        <td width="250" class="checklist">
          <label class="padding">Users</label>
          {{ form.authors }}
        </td>
      {% endwith %}
      </tr>
    </tbody>
  </table>


  <br />
  <br />
  <br />
  {% endifnotequal %}
  {% endblock %}

  {% if page %}
    <div class="pag">
    {% pagetabs page %}
    </div>
    {% endif %}
    <table class="rounded">
    <thead>
      <tr>
        <th class="checkbox">
          {{ formset.management_form }}
          <input type="hidden" id="bulk_action" name="bulk_action" value="" />
          <input type="checkbox" id="toggle_all"/>
        </th>
        {% for header in headers %}
        <th>
            {% if header.sort %}
            <a class="{% if forloop.last %}last {% endif %}{{ header.class }}" href="{{ header.link }}">
              {{ header.label }}
            </a>
            {% else %}
            <span>{{ header.label }}</span>
            {% endif %}
        </th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% if formset.non_form_errors %}
      <tr>
        <td colspan="4">{{ formset.non_form_errors }}</td>
      </tr>
      {% endif %}
      {% for form in formset.initial_forms %}
      <tr class="{% cycle "" "grey" %}" {% if form.errors %}style="display: none;"{% endif %}>
        <td>{{ form.bulk }}</td>
        {% block columns %}
        <td>
          <a href="{{ form.instance.get_absolute_url }}">{{ form.instance.name }}</a>
          <div class="actions">
            <a href="#" onclick="return showEdit(this, true);">Edit</a> | <a href="#" class="delete_icon" onclick="return toggleDelete(this);">Delete</a> {{ form.DELETE.as_hidden }} | <a href="{{ form.instance.get_absolute_url }}" class="view_icon">View</a>
          </div>
        </td>
        <td>
          {% if form.instance.video_service %}
          {{ form.instance.video_service }} User
          <strong>{% if form.instance.feed %}{{ form.instance.feed.name }}{% else %}{{ form.instance.video_service_user }}{% endif %}</strong>
          {% else %}
          {% if form.instance.search %}
          Saved Search: <strong>{{ form.instance.search.query_string }}</strong>
          {% endif %}
          {% endif %}
        </td>
        <td>{% for category in form.instance.categories.all %}{{ category.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</td>
        <td class="last" width="19%">{% if form.instance.when_published %}<span class="pub_date">{{ form.instance.when_published|date:"M, d Y" }}</span>{% endif %} </td>
        {% endblock %}
      </tr>
      <tr class="editing {% cycle "" "grey" %}" {% if not form.errors %}style="display: none;"{% endif %}>
        <td colspan="{% block quick-edit-colspan %}3{% endblock %}">
          {{ form.id }}
          {{ form.non_field_errors }}
          <h3>{% block quick-edit-title %}<span>{{ form.name.errors }}</span>{{ form.name }}{% endblock %}</h3>
          {% block quick-edit %}
          <table>
            <tr>
              <td colspan="2">
                <label>Video URL</label>
                {{ form.file_url.errors }}
                {{ form.file_url }}
              </td>
            </tr>
            <tr>
              <td colspan="2">
                {{ form.thumbnail_url.errors }}
                {{ form.thumbnail.errors }}
                <label>Thumb URL</label>
                {{ form.thumbnail_url.errors }}{{ form.thumbnail.errors }}
                {{  form.thumbnail_url }}
                <div style="float: right; width: 286px;">
                  or <a href="#" onclick="$(this).next().show(); return false;">upload</a> a new thumbnail
                  <span style="display: none;">{{ form.thumbnail }}</span>
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="2">
                {{ form.when_published.errors }}
                <label>Date</label>
                {{ form.when_published.errors }}
                {{ form.when_published }}
            </td>
            </tr>
            <tr>
              <td>
                {{ form.description.errors }}
                <label class="floatnone">Description</label>
                {{ form.description.errors }}
                {{ form.description }}
              </td>
              <td>
                {{ form.embed_code.errors }}
                <label class="floatnone">Embed Code</label>
                {{ form.embed_code }}
                {{ form.tags.errors }}
                <label class="floatnone">Tags</label>
                {{ form.tags.errors }}
                {{ form.tags }}
              </td>
            </tr>


          </table>
          {% endblock %}
          <button class="med_button marginbottom behave" type="button" onclick="return showEdit(this, false);"><span>Cancel</span></button>
          <button type="submit" class="med_button marginbottom behave" name="submit" value="Save"><span>Update</span></button>
        </td>
        {% block quick-edit-additional-columns %}
        <td width="250" class="checklist">
          {{ form.categories.errors }}
          <label class="padding">Categories</label>
          {{ form.categories.errors }}
          {{ form.categories }}
        </td>
        <td width="250" class="checklist">
          {{ form.authors.errors }}
          <label class="padding">Users</label>
          {{ form.authors.errors }}
          {{ form.authors }}
        </td>
        {% endblock %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if page %}
  <div class="pag bottom">
    {% pagetabs page %}
  </div>
  {% endif %}
</form>
</div>
{% endblock content %}

