language: python
python:
  - "2.6"
  - "2.7"
env:
  -
  - MIGRATIONS=yes
  - SEARCH=elasticsearch
  - DB=mysql
  - DB=postgres
before_install:
  - sh -c "if [ '$SEARCH' = 'elasticsearch' ]; then sudo service elasticsearch start; sleep 3; fi"
install:
  - pip install . --no-deps
  - pip install --use-mirrors -r test_mc_project/requirements.txt
  - sh -c "if [ '$MIGRATIONS' = 'yes' ]; then pip install --use-mirrors south; fi"
  - sh -c "if [ '$SEARCH' = 'elasticsearch' ]; then pip install --use-mirrors git+git://github.com/toastdriven/pyelasticsearch@3bfe1a90eab6c2dfb0989047212f4bc9fb814803#egg=pyelasticsearch; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then pip install --use-mirrors mysql-python; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then pip install --use-mirrors psycopg2; fi"
before_script:
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -c 'CREATE DATABASE mirocommunity_test;' -U postgres; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql -e 'CREATE DATABASE mirocommunity_test;'; fi"
script:
  - cd test_mc_project
  - ./manage.py test localtv --verbosity=2
  - ./manage.py test localtv.contrib.contests --verbosity=2
